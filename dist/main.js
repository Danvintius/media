(()=>{"use strict";(new class{constructor(){this.container=document.getElementById("widget"),this.addTicket=this.addTicket.bind(this),this.elem=null}createWidget(){const t=document.createElement("div");t.classList.add("widget-container"),t.innerHTML='\n      <div class="list"></div>\n      <div class="footer">\n        <form class="form">\n          <input class="form-input" name="input" type="text">\n        </form>\n      </div>\n              ',this.container.appendChild(t),document.querySelector(".form").addEventListener("submit",this.addTicket)}addTicket(t){t.preventDefault(),this.elem=document.createElement("span"),this.elem.textContent=t.target.input.value,this.getPosition()}getPosition(){navigator.geolocation&&navigator.geolocation.getCurrentPosition((t=>{const{latitude:e,longitude:n}=t.coords;this.showTicket(e.toFixed(5),n.toFixed(5))}),(t=>{this.showModal(),console.error(t)}))}resetInput(){this.container.querySelector(".form-input").value=""}showTicket(t,e){const n=document.querySelector(".list"),i=document.createElement("div");i.classList.add("ticket"),i.innerHTML=`\n         <div class="elem"></div>\n         <div class="date">${(new Date).toLocaleString()}</div>\n         <div class="geo">[${t},${e}]</div>\n      `,n.insertAdjacentElement("afterbegin",i),this.container.querySelector(".elem").insertAdjacentElement("afterbegin",this.elem),this.resetInput()}showModal(){const t=document.createElement("div");t.classList.add("modal"),t.innerHTML='\n        <div class="modal-text">Что-то пошло не так  \n        <p>Извините, но мы не можем определить ваше местоположение, \n        пожалуйста, дайте нам разрешение на использование геолокации \n        либо введите координаты вручную\n        </p>\n        <p>Широта и долгота через запятую</p>\n        <form class="modal-form">\n          <input class="modal-input" name="modal" type="text">\n          <div class="buttons">\n          <button type="reset" class="reset">Отмена</button>\n          <button type="submit" class="ok">Ok</button>\n          </div>\n        </form>\n        </div>\n      ',this.container.querySelector(".widget-container").appendChild(t),this.container.querySelector(".modal-input").addEventListener("input",this.deleteError),this.container.querySelector(".modal-form").addEventListener("submit",(t=>{t.preventDefault();let e=this.checkValidity(t.target.modal.value);if(console.log(e),e){e=e[0].split(",");const t=e[0].trim(),n=e[1].trim();this.hideModal(),this.showTicket(t,n)}else alert("Координаты введены не верно")})),this.container.querySelector(".modal-form").addEventListener("reset",(t=>{t.preventDefault(),this.hideModal()}))}hideModal(){this.container.querySelector(".modal").remove(),this.resetInput()}checkValidity(t){return t.match(/^\[?\d+\.\d+,\s?\-?\d+\.\d+\]?$/gm)}}).createWidget()})();